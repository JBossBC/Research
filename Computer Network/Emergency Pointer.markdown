# Emergency Pointer

## 紧急数据传输

已经建立连接的C/S两端中，当某一端发生了比较严重且紧急的事件时，需要在不建立新连接，即在当前连接的基础上将该信息迅速通知到对端，但是在TCP数据传输中肯定要遵守先写入缓冲区的数据先被发送的规则，除非你的数据有某种优先权。这种优先权就是TCP数据传输中的紧急模式，这类似于其他传输层协议中的带外数据(经加速数据)的说法，**大部分传输层协议都有解决紧急数据传输的实现，除了UDP协议中没有带外数据的实现方法**

## TCP紧急模式

TCP紧急模式设置特别简单，假设有一组已经在套接字缓冲区中排队将要发送到对端的数据(1,2,3,4,5...N),**在该缓冲区中要发送的数据末尾设置OOB标记作为缓冲区中的最后一个字节**，通常存在一个紧急指针指向OOB标记字节的下一个字节，而OOB标记字节的前一个字节就会作为紧急数据随同其前一系列普通数据发送到对端，程序中那个设置的话send(fd,"a",1,MSG_OOB);以上的意思就是将a设置成紧急字节发送到对端

对于紧急数据的发送，要在TCP数据包首部设置URG标记和紧急指针，以上是可以找到相应的位置,URG标记是用来让TCP检查紧急指针紧急偏移的，没有的话是不会检查的，要是有的话，就通过检查紧急指针偏移量来定位紧急数据在TCP数据部分所处的位置。

当URG位为1时，TCP头部节点的紧急指针会记录一个偏移量，指向紧急数据的最后一位(也可以是紧急数据下一位，两者都是标准)，在读取到紧急指针所指向的位置之前，TCP的接受进程都处于紧急状态，当读取到紧急数据后一位时，恢复到正常状态。

从上面的特性可以看到，**TCP无法告诉紧急数据从哪里开始，只能高速紧急数据从哪里结束**，