# DataLink layer

![](https://img-blog.csdnimg.cn/20210507194739277.png)

1）源地址和目的地址：MAC地址（48位）

2）类型

- 08xx	协议类型
- 0806	ARP请求
- 0835	ARP应答
- 0800	ip协议

### Question

为什么ip协议和tcp协议中协议信息保存的自己的，而数据链路层中type为层网络层的信息
为什么网桥能够互连两个采用不同传输介质与不同传输速率的网络?

## 什么是网桥?

    网桥:一种桥接器，连接两个局域网的一种存储/转发设备。工作在数据链路层，是早期的两端口两层网络设备。可将一个大的VLAN分割为多个网段，或者将两个以上的LAN互联为一个逻辑LAN，使得1LAN上的所有用户都可以访问服务器

    最简单的网桥只有两个端口，复杂的网桥可有多个端口。网桥的两个端口分别有一条独立的交换信道，但不是共享一条背板总线，可以隔离冲突域。火来随着交换机的发展和应用，组件被拥有更多端口又能隔离冲突域的交换机所替代


## 工作原理

   网桥是一种对帧进行转发的技术，根据MAC分区块，可隔离碰撞。网桥在网络的同一网段在数据链路上连接起来，但是只可以连接同构的网络(即同一网段)，不能连接不同网段的网络。
    
   通过将两个相似的网络连接起来，且对网络数据的流通进行管理。因其工作在二层网络(数据链路层)，不仅可以扩展网络的距离或范围，还可以提高网络的性能、安全性、可靠性。

![](https://img-blog.csdnimg.cn/2021072010100992.png)

   网络1和网络2通过网桥进行连接后，网桥将接收到的网络1发送的数据报，通过检查包中的地址，进行相应的转发
      
   1. 如果收到的是网络1的数据报，将其丢弃;
   2. 如果收到的是网络2的数据报，就继续发送给网络2
   
 从而通过利用网桥实现隔离信息，将同一个网络号划分多个网段，隔离出安全网段，防止其他网段内的用户非法访问

由于网络的分段，各网段相互独立(属于同一个网络号)，一个网段故障不会影响到其他网段的运行
    
网桥的功能在延长网络跨度上类似于中继器(物理层),然而它能提供智能化连接服务，即根据帧的终点地址处于哪一网段来进行转发和滤除。
    

### 网桥的优点

1. 过滤通信量，可以使局域网的一个网段上各工作站之间的信息量局限在本网段的范围内，而不会经过网桥到其他网段中。
2. 扩大物理范围，增加局域网上的工作站的最大数目？？？
3. 可以使用不同的物理层，可以互联不同的局域网
4. 提高可靠性。可将较大的局域网分割成若干个小的局域网，局域网内部的信息量会高于网络间的信息量，从而使得整个互联网络的性能便好？？？


### 网桥的缺点

1. 增加时延。因为网桥对接受的帧要先进行存储和查找站表，然后进行转发，所以一定程度上增加了网络时延。
2. MAC子层不存在流量控制的功能，当网络上负荷严重时，可能因网桥缓存区的存储空间不够导致溢出，产生数据帧丢失的情况
3. 具有不同MAC子层的网段桥接在一起时，网桥在转发一个帧之间，必须修改帧的某些字段的内容，以适合另一个mac子层的要求，增加时延
4. 网桥只适合用于用户数量不多的情况下(大致不超过几百个)和信息量不太大的局域网中，不然可能会产生交大的广播风暴？？？？



## 网桥的特性

网桥是数据链路层互联的设备，在网络互联中起到数据接收，地址过滤，数据转发的作用，实现多个网络系统之间的数据交换。

&emsp;&emsp;
基本特征:
                  1. 网桥在数据链路层上实现局域网互联
                  2. **网桥能够互连两个采用不同传输介质与不同传输速率的网络**,网桥对数据实体进行了操作，相当于接收数据的时候对数据进行了帧恢复，然后再对进行帧操作适配发送取出的网络线路。
                  3. 网桥以接收、存储、地址过滤与转发的方式实现互连的网络之间的通信
                  4. 网桥需要互联的网络在数据链路层以上采用相同的协议
                  5. 网桥可以分割两个网络之间的通信量，有利于改善互联网络的性能与安全性
      
 
## 交换机

交换机的出现是为了解决连接在集线器上的所有主机会**共享可用带宽**，使得冲突域过大，从而造成网络堵塞的问题。**交换机是通过为需要通信的两台主机直接建立专用的通信信道来增加可用带宽的**，从一定层面上交换机类似于多端口的网桥.

局域网交换机的基本功能与网桥一样，具有帧转发、帧过滤的功能。但是，交换机与网桥相比还是存在以下不同

+ 交换机工作时，实际上允许多组端口间的通信同时工作。所以，交换机的功能体现出不仅仅是一个网桥的功能，而是多个网桥功能的集合，即网桥一般分有两个端口，而交换机具有高密度的端口
+ 分段能力的区别:由于交换机能够支持多个端口，因此可以把网络系统划分为更多的物理网段，这样使得整个网络系统具有更高的带宽，而网桥仅仅支持两个端口。所以，网桥划分的物理网段是相当有限的。
+ 传输速率的区别:交换机与网桥数据信息的传输速率相比，交换机要快于1网桥
+ 数据帧转发方式的区别:网桥在发送数据帧前，通常要接收到完整的数据帧并执行帧检测序列FCS后，才开始转发该数据帧，而交换机则具有存储转发和直接转发两种帧转发方式。**直接转发方式在发送数据以前，不需要在接收完整个数据帧和经过循环冗余校验码CRC的计算检查后的等待事件。**

### 位于第二层的交换机是通过查找MAC地址表将接收到的数据传送到目的端口的。相比于集线器，交换机可以分割冲突域，每一个端口为一个单独的冲突域。


## 交换机工作原理
![](https://img-blog.csdnimg.cn/20201128080654715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDI0MzYyMw==,size_16,color_FFFFFF,t_70)


主机Ⅰ向主机Ⅳ发送消息的过程:主机Ⅰ在各层上的数据都封装完毕唯独在数据链路层没有目的主机的mac地址，所以主机Ⅰ会发送一个ARP广播。

**ARP广播是可以穿越交换机的，路由器隔离广播**，主机Ⅳ在听到广播后就会给主机Ⅰ一个回应。

### 交换机自学习过程

1. 交换机收到该广播包后，会记录主机Ⅰ的MAC地址和对应的端口，然后转发该广播(泛洪传播)
2. 交换机B收到广播包之后，同样也会记录主机Ⅰ的MAC地址和对应的端口号，然后转发该广播(泛洪传播)
3.  主机Ⅳ收到广播之后就会回应，交换机B会记录主机Ⅳ的MAC地址和对应的端口号，然后查看目标主机的MAC地址，从对应的端口发送出去(这个是在之前的MAC地址表已经记录了主机Ⅰ的MAC地址)交换机A也会记录主机Ⅳ的MAC地址和对应的端口。
4. 主机Ⅰ收到目标主机的MAC地址后，再将数据封装，发送出去，这个时候交换机A已经形成了MAC地址，然后查看目标主机的MAC地址，直接将数据帧从对应的端口发送出去。

交换机A形成的MAC地址表

|MAC地址|端口|
|--|--|
|主机Ⅰ的MAC地址|1|
|主机Ⅳ的MAC地址|3|

交换机B形成的MAC地址表

|MAC地址|端口|
|--|--|
|主机Ⅰ的MAC地址|3|
|主机Ⅳ的MAC地址|2|

## Conclusion

从总的来看物理层和数据链路层的区别，物理层的作用是实现0、1比特流与电压的高低、光的闪灭之间的互换，数据链路层则是负责物理层面上互连的、节点之间的通信传输。从两层的设备上面来看，物理层的集线器和中继器保证了数据传输的持久性，解决了数据在传输过程中可能会发生的消耗导致数据出错，它仅仅做了一个信号的放大或者说是再生，为了增大传输的距离，没有对数据实体进行处理。数据链路层的网桥和交换机定义了每个数据帧的边界方便了进行对真正目的的数据传输，而不是物理层那样通过广播来达到数据传输的目的，网桥和交换机对数据实体进行了初步的处理，不仅通过FCS(帧校验序列(CRC算法))对数据实体进行差错检测，同时通过MAC地址对数据实体进行特定目的的发送，不像物理层那样通过广播来实现数据传递。这其实就是冲突域的来源和解决方法的展现。
