# Avatar

## 案件描述

Avatar项目于2023年2月8日部署至polygon链,以超高收益率（单利静态最高收益超过30%月化每天）吸引大量用户入场且主要用户为中国大陆用户。至2023年2月26日预估入金接近14亿人民币，项目方收益超过2763万人民币。其代码逻辑与传销如出一辙，以上线拉下线进场为主要收益手段，散户进场风险极高，操盘手已经收割了1级魔盒12次，2级魔盒1次，造成散户巨额经济损失，对社会危害极大。



## 合约介绍

+ ReentrancyGuard.sol合约类似于保证串行化交易，一定程度上防止重入攻击和保证call函数的安全
+ Avatar.sol合约为业务的主要合约，极其重要的函数分别有OpenPosition 和 ClosePosition两种
+ Bucket.sol合约主要是用来生成随机天数的

## 项目用途

+ 本项目为用户提供了两种盈利方式，第一种通过购买盒子，也就是Position来获取定期收益，称为静态收益,第二种通过类似于发展下级来获取动态收益。

## 静态收益


用户可以选择1到6种不同的盒子来购买，每种不同的盒子需要锁定不同的天数才能开启，每种盒子每一轮单独成池，日收益率初始为1%，范围在0.3%-1.5%

魔盒I——24小时满，可随时提取种子和回报

魔盒II ——3-8日为一个周期（随机生成日期）

魔盒III ——9-16日为一个周期

磨合IV ——17-31日为一个周期

魔盒V ——32-91日为一个周期

魔盒VI ——92-181日为一个周期。


每个盒子的收益与Avatar合约里FundTarget中Amount和targetAmount相关，当预期的募集资金超过了现有的资金总量，会降低获得的收益率（每超过targetAmount20%降低0.05%，保底收益0.3%）。不仅如此,每个盒子的收益率还与userGrobalInfo里面的boostCredit（止损时获得）相挂钩，可以使用boostCredit提高0.5%收益率。


> 注意:用户在投资静态收益的时候，所投资的金额有5种取出:①、保本资金(65%),②、平台抽成(2%)、③、激励池(幸运儿池)(1%)、④、静态收益池(26%)、⑤、动态收益池(发展下级)(6%)


当且仅当静态收益池为空的时候，开启下一个纪元

## 动态收益

用户可以发展下级来获取动态收益，动态收益的获取主要为两个方面:官方称为:精灵奖和部落奖。分别占据购买盒子的金额的百分之1.2和百分之4.8，动态收益单独收取。

### 精灵奖

referrer所处的社区等级决定了他是否能够获得对应的精灵奖励,根据Avatar.sol合约里面的_getLevelToLevelSearchStep函数表明,当社区等级大于等于5时,用户最多能让10个上级分别获得0.12%的收益，当社区等级小于5时,用户的上级在分享了精灵奖后,剩余的资金将返回给用户的referrerAmount(代理收益中)。

### 部落奖

该游戏强调部落这个概念，该游戏将部落分为12个等级,每个等级有不同的利润抽成,当用户购买了盒子以后,用户的上级会根据当前的部落等级差进行利润抽成,当部落等级差距越大时,代理方会获得更多的收益,当用户的部落奖金还未分配完时,剩余的资金将返回给用户的referrerAmount(代理收益中)

## 幸运儿奖

为了鼓励用户的积极参与,在爆仓后,会给予最后参与的60个盒子拥有者分享来自于激励池里面的全部奖金,具体的分配金额与该六十个盒子所投资金额占比有关。


## 功能描述

> 具体对项目源码的解读全部在合约里面有注释，主要介绍给用户提供的两种重要方法


### OpenPosition

+ 首先判断所购买的箱子类型是否合法,并且判断所投资的金额是否合理，以及参加的轮数是否合理，以及游戏是否开启
+ 计算当前投资收益率
+ 根据选择是否增强收益(通过boostCredit)
+ 分配6%给上级(动态收益)
+ 转给平台2%


### ClosePosition

+ 从保本资金池里面取出65%
+ 如果静态收益池里面有，则取出所属部分的收益和另外本金，否则尽量满足
+ 判断此盒子是否是幸运儿盒,如果是则领取幸运儿奖
+ 判断是否亏钱，除开如果存在的幸运儿的奖励,如果亏钱则增加boostCredit
+ 转账给用户最终的金额


## 项目方盈利情况

+ 首先是每笔交易的平台抽成(2%)

项目方地址：0x9cA75D0d97f0b86dEa852Eb0a626F7839673d9D9（platformaddress）

因为该地址没有转出记录，所以可以估算项目方入金将近14亿人民币，收益超过2763万人民币。

![image-20230227004720075](https://hexoimagehost.oss-cn-chengdu.aliyuncs.com/img/image-20230227004720075.png)

![image-20230227004747781](https://hexoimagehost.oss-cn-chengdu.aliyuncs.com/img/image-20230227004747781.png)

+ 但是根据功能分析后显示,最初的referrer的创建必须要有admin权限(batchSetReferrerInfo函数),由项目方admin创建。而根据实际调研来看，项目方将这些初始化地址的部落等级设置成10级甚至是12级，如果这些地址是项目方成员拥有，则不仅可以获得巨额拉下线收益，也可以进行操盘获益。

![image-20230227005308113](https://hexoimagehost.oss-cn-chengdu.aliyuncs.com/img/image-20230227005308113.png)
## 代码缺点

+ UserRoundInfo里面的returnRateBoostedAmount似乎没有在Avatar和bucket中用到